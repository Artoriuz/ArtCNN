// MIT License

// Copyright (c) 2024 Joao Chrisostomo

// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:

// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.

//!DESC ArtCNN C4F8 (Conv2D)
//!COMPUTE 16 16 8 16
//!HOOK LUMA
//!BIND LUMA
//!SAVE conv2d
//!WIDTH LUMA.w 2.0 *
//!HEIGHT LUMA.h
//!COMPONENTS 4
//!WHEN OUTPUT.w LUMA.w / 1.3 > OUTPUT.h LUMA.h / 1.3 > *
#extension GL_EXT_shader_explicit_arithmetic_types_float16 : enable
#ifdef GL_EXT_shader_explicit_arithmetic_types_float16
#	define V4 f16vec4
#	define M4 f16mat4
#	define F float16_t
#else
#	define V4 vec4
#	define M4 mat4
#	define F float
#endif

const ivec2 ksize = ivec2(3, 3);
const ivec2 offset = ksize / 2;
const ivec2 isize = ivec2(gl_WorkGroupSize) + ksize - 1;
shared F inp[1][isize.y][isize.x];
void hook() {
    ivec2 base = ivec2(gl_WorkGroupID) * ivec2(gl_WorkGroupSize);
    for (uint y = gl_LocalInvocationID.y; y < isize.y; y += gl_WorkGroupSize.y) {
        for (uint x = gl_LocalInvocationID.x; x < isize.x; x += gl_WorkGroupSize.x) {
            inp[0][y][x] = F(LUMA_mul * texelFetch(LUMA_raw, (base + ivec2(x,y) - offset) * ivec2(1, 1) + ivec2(0, 0), 0).x);
        }
    }

    barrier();
    V4 result0 = V4(-0.028681401, -0.0023863742, -0.10209655, -0.024072282);
    result0 += V4(0.056237645, -0.15700646, -0.067422405, 0.09884551) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += V4(0.04420475, -0.091214456, 0.2296614, -0.36220852) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += V4(-0.017318528, -0.21107352, -0.1654709, 0.06855703) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += V4(0.18184002, 0.2953797, 0.14726086, -0.21440057) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += V4(0.42580852, 0.011210862, 0.44482464, 0.7924355) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += V4(0.044070214, -0.034170292, 0.14868914, -0.077008106) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += V4(0.068901144, 0.036256194, -0.13125087, 0.12538625) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += V4(0.1178359, 0.22316542, -0.18811403, -0.24424624) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += V4(-0.15561688, 0.011334069, 0.13579842, -0.06196985) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos0 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(0, 0);
    imageStore(out_image, store_pos0, result0);
    V4 result1 = V4(0.025531404, -0.02268054, -0.05561039, -0.033896625);
    result1 += V4(-0.13394926, 0.2097782, 0.008090102, -0.22554632) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += V4(0.2841014, -0.0759206, -0.15947226, 0.092292376) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += V4(0.07462216, 0.21187358, -0.19430897, -0.097131625) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += V4(-0.096949816, 0.025842607, 0.35660726, 0.009373545) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += V4(0.41594228, -0.21220505, 0.18312456, 0.22918095) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += V4(-0.3820385, -0.2647966, 0.015932776, -0.1389993) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += V4(-0.10489803, -0.009172484, -0.036202215, 0.044231594) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += V4(-0.013980226, 0.22947948, 0.041807696, 0.1289274) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += V4(-0.011900482, -0.024186302, -0.20339993, -0.025482565) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos1 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(1, 0);
    imageStore(out_image, store_pos1, result1);
}

//!DESC ArtCNN C4F8 (Conv2D-1-ReLU)
//!COMPUTE 16 16 8 16
//!HOOK LUMA
//!BIND conv2d
//!SAVE conv2d_1
//!WIDTH LUMA.w 2.0 *
//!HEIGHT LUMA.h
//!COMPONENTS 4
//!WHEN OUTPUT.w LUMA.w / 1.3 > OUTPUT.h LUMA.h / 1.3 > *
#extension GL_EXT_shader_explicit_arithmetic_types_float16 : enable
#ifdef GL_EXT_shader_explicit_arithmetic_types_float16
#	define V4 f16vec4
#	define M4 f16mat4
#	define F float16_t
#else
#	define V4 vec4
#	define M4 mat4
#	define F float
#endif

const ivec2 ksize = ivec2(3, 3);
const ivec2 offset = ksize / 2;
const ivec2 isize = ivec2(gl_WorkGroupSize) + ksize - 1;
shared V4 inp[2][isize.y][isize.x];
void hook() {
    ivec2 base = ivec2(gl_WorkGroupID) * ivec2(gl_WorkGroupSize);
    for (uint y = gl_LocalInvocationID.y; y < isize.y; y += gl_WorkGroupSize.y) {
        for (uint x = gl_LocalInvocationID.x; x < isize.x; x += gl_WorkGroupSize.x) {
            inp[0][y][x] = V4(conv2d_mul * texelFetch(conv2d_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(0, 0), 0));
            inp[1][y][x] = V4(conv2d_mul * texelFetch(conv2d_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(1, 0), 0));
        }
    }

    barrier();
    V4 result0 = V4(0.08888515, -0.06996599, -0.092141576, 0.20921856);
    result0 += M4(-0.0650856, 0.091473274, 0.009003904, 0.04922432, -0.080406465, 0.1096053, 0.033987172, -0.24614958, 0.067697905, 0.27551043, -0.122105874, -0.12804872, 0.008138326, 0.31031874, 0.0035501467, 0.07572969) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.182073, 0.058827873, -0.053687043, 0.0487649, 0.13287342, 0.72826356, -0.2226391, 0.13383335, 0.1804309, -0.24688958, 0.14952108, 0.11137967, 0.039817363, -0.7694141, 0.10709497, 0.17915079) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.010301285, 0.040892683, -0.15722199, -0.059435174, -0.13268308, 0.15746468, -0.079712614, -0.14439493, -0.055738185, -0.58188355, -0.09784434, 0.005416486, 0.14661615, -0.13655895, 0.04939398, -0.22687446) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.0018700088, -0.13235031, -0.28953853, 0.20939043, -0.36146381, -0.22212367, 0.0092923455, -0.3439596, 0.03990087, 0.103834964, -0.11199488, -0.14704499, -0.23136744, -0.05803696, -0.15688999, 0.33268455) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(0.32969868, 0.013576435, 0.22944084, 0.0024947473, 0.027627312, 0.14000006, 0.5588421, 0.053613823, 0.44677883, 0.1860139, -0.66030025, 0.046379026, 0.6850517, -0.024360422, -1.3414423, -0.4287348) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.053968403, 0.20746103, -0.015451305, 0.0063875695, -0.20325266, -0.17680863, 0.27254897, -0.2343872, 0.035048924, -0.20286444, -0.018160978, 0.25279695, 0.45983735, 0.35497403, 0.043475043, 0.43289) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(0.33383158, 0.18201153, 0.15179546, -0.37153655, -0.04731919, -0.07361654, -0.1224666, 0.14570278, 0.053064134, -0.47980708, 0.21024777, 0.20420548, -0.13136138, -0.07689012, -0.0527768, 0.30263808) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(0.39874643, 0.0613535, 0.39113054, -0.10672204, -0.058682006, -1.0522879, 0.80353934, 0.24928318, 0.15816037, -0.08322112, -0.045828916, -0.34080833, -0.34837505, 0.25300765, 1.0603482, 0.3533068) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.06461529, -0.17039776, 0.08472385, 0.06772973, 0.029691588, 0.8304672, 0.005419817, 0.23240876, 0.020862412, 0.2297035, 0.028901426, -0.14732975, -0.01096643, 1.0320474, -0.021011924, 0.09006558) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.035477087, 0.005754648, -0.0079935435, 0.10861972, 0.179887, 0.052222442, -0.08540632, 0.25356346, -0.11822828, -0.17205933, 0.12934704, 0.051262587, 0.077156894, 0.2868312, -0.04308089, 0.34440756) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.2226782, -0.3833453, -0.18146239, -0.06128315, -0.22080341, 0.6161636, 0.14595015, -0.27590063, -0.44672278, -0.3120885, -0.24396725, -0.060807105, -0.072939, -0.08093786, 0.044414572, 0.028055899) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(0.044733375, -0.15084757, -0.13021675, 0.020294923, -0.22148588, 0.32465205, -0.030975975, 0.111055024, 0.046789948, -0.11753304, 0.05611402, 0.17387407, -0.023485372, 0.11632263, 0.12346992, -0.00053154025) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(0.2719669, -0.48839524, 0.16384096, 0.58368015, 0.14310674, -0.22279444, 0.22195448, 0.09326018, 0.2257641, -0.20430896, 0.2607383, 0.4185789, -0.18139507, -0.32801563, 0.114664696, -0.07680771) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(0.5925315, 0.86559033, -0.7152872, 0.032539967, 0.06901919, -0.6202798, 0.942713, -0.57420963, 0.056514688, -0.20207115, -0.39194816, 0.052978758, 0.045186527, 0.40458572, 0.04912057, 0.066445984) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(0.119581506, -0.23191234, -0.28186122, -0.056539107, -0.50686646, 0.16437441, 0.20081387, 0.0041644927, -0.22163612, -0.30771473, -0.14956914, -0.37600252, 0.2497541, 0.060670987, 0.0153825795, 0.28790456) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.054934666, -0.4730335, -0.18837442, -0.21821548, -0.032706603, -0.36323592, -0.55574733, -0.5594236, -0.108660586, -0.28731105, -0.044849034, 0.46173784, -0.06898124, 0.16647027, -0.22274795, -0.12366363) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(0.16324796, -0.079319105, 0.5323551, -0.41318607, -0.08416913, 0.6515014, 0.013066641, 0.285546, -0.1386399, 0.48026523, -0.8906941, 0.17182718, -0.12982136, -0.42656744, 0.45547903, -0.04095951) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(0.17163767, -0.11355728, 0.33185175, -0.08919219, -0.10644601, 0.42518738, -0.21046631, -0.0050414135, -0.056862902, -0.26126617, -0.01738488, -0.049391128, 0.19989124, -0.04751292, -0.0573068, 0.42932907) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos0 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(0, 0);
    imageStore(out_image, store_pos0, max(result0, V4(0.0)));
    V4 result1 = V4(0.09762192, -0.03878961, -0.022976343, -0.09021986);
    result1 += M4(0.0011880951, -0.22083175, -0.026756423, -0.14400434, -0.047565117, 0.05294728, -0.04065713, 0.084923014, 0.06101594, 0.244647, 0.06946724, 0.4149735, 0.17270999, -0.66278666, -0.094603986, 0.11350512) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(0.08671999, 0.21709026, -0.06019868, 0.24561563, 0.16581759, 1.0218616, -0.12419193, 0.7396613, -0.15958625, -0.3499646, -0.024924044, -0.77308905, -0.14312911, -0.96053344, -0.084353656, -0.7281422) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.124016225, -0.018668933, -0.013688282, 0.2584983, 0.005414823, 0.12803465, 0.10938531, 0.16441269, 0.0022006433, 0.0051077977, 0.028112045, 0.06417705, -0.12797405, 0.12454212, -0.00019547743, 0.029458463) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(0.18400666, -0.035533305, -0.067065276, -0.062611245, -0.32094708, -0.21574941, -0.15246995, -0.37907216, -0.21766697, 0.19165732, -0.080149256, -0.27386895, 0.2621762, -0.079543136, -0.12908651, -0.18197927) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(0.21781518, -0.01969914, -0.21101934, 0.10505364, -0.22665945, -0.50476396, -0.19053783, -0.5807891, 0.5870197, 0.11763913, -0.15958443, 0.09454347, 0.7794991, 0.13633455, -0.9844755, 0.4866609) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(0.08496434, 0.029779268, 0.16820489, -0.014604777, -0.040767256, -0.017403651, -0.2617265, 0.20372503, 0.008021635, -0.21022111, 0.46152088, -0.15789208, -0.30804807, 0.82607263, 1.6570498, -0.32937557) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(0.020771073, -0.34073547, -0.013188639, 0.036059204, 0.0015298419, 0.20901155, 0.22875662, 0.30570436, 0.14698668, 0.07961019, 0.09179766, 0.16600938, 0.21131936, 0.38276744, 0.10530705, 0.4834713) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(0.27454433, 0.13432194, -0.17090349, 0.07884482, 0.30659682, 0.2896377, 0.01788543, -0.28383878, -0.15895028, -0.24846429, -0.036527123, -0.16948867, 0.20318513, 0.87516105, 0.12716198, -0.084724694) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(0.1780766, -0.0987083, 0.1126155, 0.14009848, -0.19505674, 0.3092274, 0.030364197, 0.035764158, -0.034380544, 0.26627612, 0.10894123, -0.13091083, -0.090853214, 0.099136114, 0.2257882, -0.27938142) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result1 += M4(0.012671973, -0.54523367, -0.048012484, -0.19104542, -0.02175145, 0.012395939, 0.026401792, 0.106779404, -0.1955818, -0.19640876, 0.0058719576, -0.4190657, 0.02680842, -0.21694452, -0.0134486845, 0.0049410122) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.2232322, -0.535261, -0.1161659, -0.06509187, -0.06672127, 0.688766, -0.36804637, 0.7066324, -0.068919204, -0.47216994, -0.13768664, -0.03723156, -0.028097197, 0.2760991, -0.08107252, 0.3646042) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.060444087, 0.059265554, 0.1341086, -0.16476704, 0.055504564, 0.15083887, 0.27928334, 0.17637977, -0.01037589, -0.10562601, 0.14885128, -0.14869694, -0.13500518, 0.015367793, 0.15624474, 0.15629797) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.01260546, -1.1081679, 0.19398354, -1.6322548, 0.11389122, -0.6016714, -0.0793225, -1.4706825, 0.28545624, -0.4817998, 0.20868203, 0.06367049, 0.0006647247, -0.11371593, -0.0728269, -0.52382386) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(0.65787107, 0.013393945, -1.3316104, 0.5767092, -0.25006723, 0.24687755, -0.26636657, 0.029877521, -0.18092677, -0.5361633, -0.4754046, -0.16841675, 0.14688307, 0.01165846, -0.12774895, -0.012988918) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.06571798, 0.13367057, 0.13253504, -0.33417115, 0.2557882, 0.051966168, -0.42814225, 0.22890338, 0.22577485, -0.007859082, -0.8137137, -0.006427079, 0.20395808, 0.116032556, 0.11757494, -0.02322175) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(0.09583164, 0.40713397, -0.021914572, 0.46378213, -0.017201595, 0.5178319, -0.08513173, 0.48178014, -0.16798481, -0.15153259, 0.009891545, -0.43262383, -0.29538593, -0.17322539, -0.108753525, 0.068538874) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(0.09362189, 0.2274673, -0.101750135, 0.30307013, -0.17868428, -0.3290086, 0.44337547, 0.016822355, -0.080010585, 0.5956214, -0.20988515, 0.23298046, 0.074238464, 0.054344587, -0.09688238, -0.3260981) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.12865376, 0.11888625, 0.38683814, -0.07429022, 0.124941625, 0.2540781, -0.2530332, 0.06834277, -0.035151966, -0.65220153, -0.1362358, 0.009943891, -0.0138764735, -0.045772582, 0.120093174, 0.08381132) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos1 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(1, 0);
    imageStore(out_image, store_pos1, max(result1, V4(0.0)));
}

//!DESC ArtCNN C4F8 (Conv2D-2-ReLU)
//!COMPUTE 16 16 8 16
//!HOOK LUMA
//!BIND conv2d_1
//!SAVE conv2d_2
//!WIDTH LUMA.w 2.0 *
//!HEIGHT LUMA.h
//!COMPONENTS 4
//!WHEN OUTPUT.w LUMA.w / 1.3 > OUTPUT.h LUMA.h / 1.3 > *
#extension GL_EXT_shader_explicit_arithmetic_types_float16 : enable
#ifdef GL_EXT_shader_explicit_arithmetic_types_float16
#	define V4 f16vec4
#	define M4 f16mat4
#	define F float16_t
#else
#	define V4 vec4
#	define M4 mat4
#	define F float
#endif

const ivec2 ksize = ivec2(3, 3);
const ivec2 offset = ksize / 2;
const ivec2 isize = ivec2(gl_WorkGroupSize) + ksize - 1;
shared V4 inp[2][isize.y][isize.x];
void hook() {
    ivec2 base = ivec2(gl_WorkGroupID) * ivec2(gl_WorkGroupSize);
    for (uint y = gl_LocalInvocationID.y; y < isize.y; y += gl_WorkGroupSize.y) {
        for (uint x = gl_LocalInvocationID.x; x < isize.x; x += gl_WorkGroupSize.x) {
            inp[0][y][x] = V4(conv2d_1_mul * texelFetch(conv2d_1_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(0, 0), 0));
            inp[1][y][x] = V4(conv2d_1_mul * texelFetch(conv2d_1_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(1, 0), 0));
        }
    }

    barrier();
    V4 result0 = V4(-0.007545001, -0.09818898, 0.0220489, -0.021502694);
    result0 += M4(0.1274815, 0.07183108, -0.03679134, 0.019916492, -1.3021221, 0.010616852, 0.003831448, -0.066859, -1.3757561, -0.0044279927, 0.044675853, 0.03848055, -0.88158554, 0.07415716, 0.002058602, 0.010506846) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(0.23468907, 0.10774692, 0.051811747, 0.34481138, 0.036913082, 0.040169843, 0.038205303, 0.37195882, -0.06632339, -0.91552544, 0.026167113, -0.83162594, -0.15039478, 0.023269001, -0.06339451, 0.13545597) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.061584353, 0.046738572, -0.048392463, -0.12546627, 0.012632562, 0.074806966, -0.004990075, -0.07053503, -0.0017954963, -0.046140216, -0.033581827, -0.38952142, -0.30081174, -0.06215157, -0.0053133024, -0.14664632) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(0.5271822, 0.31106856, -0.0050722477, -0.14726938, 0.10539253, 0.09137281, -0.089902855, 0.10191794, -0.13861422, 0.13322586, 0.05459219, 0.045702808, -0.096981384, 0.13796966, 0.10043095, 0.12800694) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(0.23156981, -0.005826693, 0.8540597, 0.569334, 0.04586483, 0.03234565, 0.08363738, -0.19895242, -0.22030383, -1.4143417, 0.026395088, -0.05144687, 0.13741505, 0.5277992, -0.038579445, 0.24877676) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(0.1280944, 0.09255776, -0.16121611, 0.04838825, -0.042156022, 0.06314175, -0.0093897665, 0.024438052, 0.05702715, 0.04130672, -0.01583106, 0.021015747, 0.0381152, 0.04471745, -0.0032594446, -0.13034156) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.3416406, 0.2931313, -0.0076283915, 0.027978897, 0.11166299, 0.11200959, -0.07361417, 0.06375593, 0.048789028, 0.054456722, 0.001068293, 0.03569767, 0.054475546, 0.16382688, -0.008143295, 0.058442324) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(0.26018602, 0.5387783, 0.0051800366, 0.2949266, -0.05226406, 0.016763026, 0.03687239, 0.04852768, -0.020902203, 0.023621676, -0.0058691064, 0.005855475, 0.0778814, 0.0033822414, 0.01359224, -0.058555327) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.090638064, 0.04761878, 0.07279595, -0.03188038, -0.024079887, 0.052714065, 0.023541318, 0.047825094, 0.028986188, 0.011518179, -0.016151784, 0.0546644, 0.0099599445, -0.08452104, 0.023765752, 0.020201873) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result0 += M4(-2.6884854, 0.06750533, 0.024194328, -0.03582834, -2.3029003, 0.032190062, 0.02907767, -0.014916482, -2.8976865, 0.019071097, 0.020638503, 0.012952356, -0.01858154, 0.031587467, -0.026943479, 0.089512944) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(0.0067835846, -0.34274542, -0.009249024, -0.7177979, -0.111134894, -0.053968575, -0.06554894, 0.21819252, 0.013515662, 0.033676997, 0.014948112, -0.25677004, 0.17893997, 0.09398382, -0.027812151, -0.2827421) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.4708997, -0.1025357, -0.18144596, -0.22947721, -0.050176635, 0.0035796117, 0.012030104, 0.008028738, 0.026727822, 0.008139717, -0.00479684, 0.066822976, 0.14297569, 0.0063330303, -0.04086083, -0.17017661) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.26193962, -0.60473466, 0.011780176, 0.018149264, 0.15826222, 0.105812475, 0.01704569, -0.08441561, -0.51191753, -1.2263644, -0.025801104, -0.2931469, -0.14014815, -0.105769075, -0.10529743, 0.11636842) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(0.45002466, -0.46118852, 0.41690215, -0.10465472, 0.09382963, 0.49470735, -0.048241124, 0.20859899, -0.0293341, -1.4158328, -0.08221386, -0.50763065, 0.38143077, 1.7214216, 0.06093175, 0.6083973) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.07420636, 0.33578092, 0.022253623, 0.2657954, -0.0876368, 0.096275195, 0.031214908, 0.3154051, -0.006447967, 0.017983822, -0.0040974636, 0.017519312, -0.18631524, -0.104178794, 0.031931702, -0.12535894) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(0.0037521697, -0.30471897, -0.080892846, 0.019124916, -0.013332913, 0.03569263, 0.046070054, -0.037201546, -0.02422525, -0.12512895, 0.051349234, -0.0076289074, -0.0628698, -0.13539314, -0.014037578, 0.010639698) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(0.14075778, -0.025698015, -0.023080237, -0.38411713, 0.06810296, 0.2529644, -0.024419803, -0.037946027, -0.010624445, -0.019846443, 0.051352624, -0.021348981, 0.012104573, 0.056244317, -0.052684143, 0.1808915) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.022172894, -0.08531223, 0.037000485, 0.101895034, 0.05752583, -0.10502988, -0.009103347, 0.0061784484, -0.0024869125, 0.03811002, -0.01716177, 0.03690619, -0.0011454567, -0.02480427, 9.114498e-05, -0.010628049) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos0 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(0, 0);
    imageStore(out_image, store_pos0, max(result0, V4(0.0)));
    V4 result1 = V4(0.0053546084, -0.21535987, -0.035905477, -0.21209364);
    result1 += M4(-0.37080288, -0.18813792, -0.1582017, -0.15610914, -0.315637, -0.07876891, -0.15517032, 0.046178684, -0.15210514, 0.06734582, -0.10050315, -0.14400633, 0.07769804, 0.09521747, -0.040561598, 0.111196876) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.41860598, -0.061744303, -0.013030131, 0.017158484, -0.40333948, -0.062434666, -0.15272619, 0.04581676, 0.1673081, 0.021180965, 0.13821542, -0.818077, 0.088755764, 0.14953472, 0.024639469, 0.10387965) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.06389261, 0.17645414, -0.04895175, 0.04050976, -0.16235074, 0.041043043, -0.05764425, 0.07670938, 0.116308175, -0.6018338, -0.20757143, -0.03715754, -0.027667744, 0.3303958, 0.024322504, 0.07962583) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(0.42110187, 0.0028101618, -0.26523367, 0.20632713, -0.44809225, -0.08107808, -0.3082363, 0.23734733, -0.13741152, 0.029568821, -0.21845141, -0.15002553, -0.124057986, 0.07195728, 0.117606156, 0.09730554) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(0.30018058, 0.1535823, 0.30002034, -0.5934367, -0.6701207, 0.058317088, -0.10317578, 0.044814643, 0.17367198, -0.45931646, 0.21580066, -0.5585656, -0.397765, 0.042713884, -0.0806302, 0.9821933) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.100259006, -0.07311122, 0.032766, -0.110332124, -0.35377836, 0.034212753, -0.015078174, -0.048421685, -0.13703756, -0.26218313, -0.15765142, -0.026142878, 0.15614131, 0.78120726, 0.05176701, 0.24983683) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.15232013, -0.1242445, -0.48547003, 0.0005064112, -0.31473646, 0.06058003, 0.029559452, 0.05473438, -0.054953072, 0.0056744665, -0.050032113, 0.051423803, -0.0046931184, 0.071184084, -0.06086006, 0.023034004) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.52395093, -0.1618006, -0.14645848, 0.72025806, -0.37429187, -0.10133148, 0.0037016366, -0.033284634, -0.03629616, -0.0035153106, 0.019987602, 0.040281545, 0.033357285, -0.13377061, 0.061088506, -0.08620456) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(0.20383334, 0.378138, 0.09351495, -0.14810343, -0.10158554, 0.04090892, 0.05985019, 0.028499968, -0.07461319, -0.03404988, -0.006001969, -0.0051880237, 0.12220402, 0.13447331, 0.10559969, 0.059758164) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result1 += M4(0.20394766, 0.27357775, -0.04661996, 0.17940558, 0.037369225, 0.016302248, -0.0676236, 0.13357063, -0.24818999, 0.109955944, -0.031715, 0.007929587, 0.0009153553, 0.07647297, 0.15035361, -0.09486724) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(0.74541956, 0.072760954, 0.4458219, -0.12214541, 0.25221002, 0.15060958, -0.04610158, 0.08686917, -0.1151234, 0.15828696, -0.014688487, 0.11073385, 0.18461142, -0.22221452, 0.21431035, -0.09500475) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(0.049599215, -0.46362212, -0.18402755, 0.10189748, 0.10418297, 0.046007335, 0.026613517, 0.02961042, -0.009925116, -0.105494864, 0.0035328157, 0.016430642, 0.11818325, 0.060558077, -0.0057343687, -0.08343269) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.018921463, -0.18763287, 0.60922563, -0.61183536, 0.067789905, -0.03227644, -0.10123213, 0.18451431, 0.08025537, 0.25960144, 0.3623358, -0.6669125, 0.33400238, 0.010424524, 0.37385324, -0.28389782) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(0.08855645, 0.19536133, -0.44754, -0.10427719, 0.24611156, 0.33611262, -0.025080327, 0.35966474, 0.1404591, -1.454522, 0.04798229, -0.17219791, -0.035154197, -0.21876475, -0.11408574, 0.49582547) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.35756347, -0.36929986, -0.0951021, 0.25076354, 0.23728958, 0.45265275, 0.10710643, 0.06629078, -0.019305455, -0.24418455, -0.013417626, 0.03056767, 0.06334755, 0.88996124, 0.21833456, -0.0324173) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.020378733, 0.13865897, 0.40551573, 0.34417823, 0.11961603, -0.027477901, -0.0917649, 0.044068113, 0.0777892, 0.2190836, 0.06828783, 0.16792227, 0.2518232, 0.053287413, 0.28094643, -0.15416662) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.20722568, 0.23682705, -0.018887857, 0.31082588, 0.39101517, 0.0100308135, -0.099185616, 0.025241345, -0.17911161, 0.22788277, 0.062485065, 0.11483074, 0.13648349, -0.20953214, 0.054126978, -0.10061896) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(0.31072035, 0.1988218, 0.081611216, -0.14313246, 0.46750268, -0.23535976, 0.014098068, 0.01042402, -0.061383627, 0.00694122, -0.0057596993, 0.01913948, 0.20186721, -0.34774616, 0.115922086, 0.035992753) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos1 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(1, 0);
    imageStore(out_image, store_pos1, max(result1, V4(0.0)));
}

//!DESC ArtCNN C4F8 (Conv2D-3-ReLU)
//!COMPUTE 16 16 8 16
//!HOOK LUMA
//!BIND conv2d_2
//!SAVE conv2d_3
//!WIDTH LUMA.w 2.0 *
//!HEIGHT LUMA.h
//!COMPONENTS 4
//!WHEN OUTPUT.w LUMA.w / 1.3 > OUTPUT.h LUMA.h / 1.3 > *
#extension GL_EXT_shader_explicit_arithmetic_types_float16 : enable
#ifdef GL_EXT_shader_explicit_arithmetic_types_float16
#	define V4 f16vec4
#	define M4 f16mat4
#	define F float16_t
#else
#	define V4 vec4
#	define M4 mat4
#	define F float
#endif

const ivec2 ksize = ivec2(3, 3);
const ivec2 offset = ksize / 2;
const ivec2 isize = ivec2(gl_WorkGroupSize) + ksize - 1;
shared V4 inp[2][isize.y][isize.x];
void hook() {
    ivec2 base = ivec2(gl_WorkGroupID) * ivec2(gl_WorkGroupSize);
    for (uint y = gl_LocalInvocationID.y; y < isize.y; y += gl_WorkGroupSize.y) {
        for (uint x = gl_LocalInvocationID.x; x < isize.x; x += gl_WorkGroupSize.x) {
            inp[0][y][x] = V4(conv2d_2_mul * texelFetch(conv2d_2_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(0, 0), 0));
            inp[1][y][x] = V4(conv2d_2_mul * texelFetch(conv2d_2_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(1, 0), 0));
        }
    }

    barrier();
    V4 result0 = V4(-0.0051282872, -0.00020053492, 0.05925233, -0.028633218);
    result0 += M4(0.011594234, 0.023183396, 0.011476717, 0.05151538, 0.3984776, -0.120027155, 0.19527191, -0.071433105, 0.14809789, 0.025443334, 0.08014664, -0.007395008, -0.030515186, -0.0046968097, -0.02247494, -0.0076386924) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(0.05476859, 0.025336994, -0.11364665, 0.036245994, -0.24384621, -0.16654271, 0.03833133, -0.18718477, -0.478031, 0.0074711083, -0.10322239, -0.11865916, -0.1411938, -0.069473304, -0.07889533, -0.06458449) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(0.08911621, 0.07192856, 0.0870048, -0.009849955, -0.032516424, -0.14638744, 0.10960977, -0.16464344, 0.051637005, 0.016516564, 0.0067603444, 0.035289463, 0.009685159, -0.053100362, 0.07429348, 0.022941224) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(0.07122525, 0.036598172, 0.02553438, -0.017803129, -0.45824653, -0.010281074, 0.12477013, -0.039317597, -0.39485326, -0.005324636, -0.07689854, 0.057561737, 0.19639117, 0.056592412, 0.065754645, 0.003961299) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.26514998, -0.13412699, 0.28728342, -0.116109066, -0.39279732, 0.6412213, -0.8891359, 0.31418863, 0.58528113, 0.63754773, 0.1835084, 0.6561806, -0.26432168, 0.11578031, -0.45235378, -0.1120064) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.06632185, 0.10294894, -0.053603675, -0.45453072, 0.07609276, -0.16540502, -0.40219635, -0.0024787819, 0.055248957, -0.12872298, -0.00010005473, -0.008889225, -0.0070352154, -0.15044065, 0.027810402, -0.026728703) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.027363878, 0.0014604038, -0.02077197, -0.02616646, -0.07828372, -0.01958989, 0.0766524, 0.00058887166, 0.029449005, -0.3111488, -0.2771643, 0.052577455, -0.068036, -0.054115303, -0.028776385, 0.070477255) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.02070903, -0.35504618, -0.3680734, -0.043375235, 0.08734337, 0.34022412, 0.05476705, 0.11398922, 0.053276777, -0.41230458, 0.27503136, -0.00879215, -0.03524989, 0.20467551, -0.013034383, 0.14442323) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(-1.3267543, -2.3674386, -0.31061423, 0.27884862, -0.037185427, 0.430211, 0.02033831, 0.023072567, -0.070789315, 0.15489596, -0.023097498, 0.005266406, 0.052775986, 0.01144569, 0.1852458, 0.015183358) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.001351708, 0.020749945, -0.001899141, 0.011659773, -0.14014986, -0.00473335, -0.023537323, 0.010479619, 0.039442547, -0.030479828, 0.02490054, -0.008391409, 0.006402002, -0.02786239, 0.083647184, -0.03924653) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(0.29351947, 0.24576385, -0.008328588, 0.1755591, 0.052304517, 0.11607562, 0.12236077, 0.08715768, 0.002866775, 0.01605313, 0.027390247, -0.037533328, 0.39609095, 0.18041089, 0.007633967, 0.03279218) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(0.28883672, 0.01881346, 0.036864713, 0.025635388, 0.11073859, 0.020566273, 0.10295712, 0.052406542, -0.07465413, -0.053344443, -0.109533034, -0.07535817, 0.008740304, 0.09827223, -0.03528975, 0.05884717) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(0.19335902, 0.22746554, -0.15101995, 0.12798676, 0.10928567, 0.06251794, -0.057220723, 0.00722982, -0.14987367, -0.06520579, 0.04224123, -0.04810457, 0.10021273, 0.07914167, 0.11176695, 0.001623188) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(0.30637392, -0.06868395, 0.27394047, 0.0065931845, 0.11539581, 0.2190184, 0.20521042, -0.01595539, -0.01399113, -0.3252414, 0.24567194, -0.041714594, -0.4548999, -0.23825797, -0.04480894, -0.017820783) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(0.1475122, 0.119242445, -0.1634964, -0.04250648, 0.03690192, 0.09860118, 0.08775671, -0.034838747, -0.14662868, 0.0057463823, 0.037524752, 0.097959444, -0.08637735, -0.25444525, 0.015668493, -0.0011094697) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(0.16230099, 0.16393995, 0.17856878, 0.02979954, 0.039058477, -0.025924807, 0.08779624, -0.022054518, 0.033861373, -0.08745986, -0.11696651, 0.026395898, 0.021109391, 0.13598953, 0.019681541, -0.038510192) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(0.14924806, -0.069698535, 0.09766852, 0.05640319, 0.012959064, -0.10322191, 0.020040499, -0.020371988, -0.12240709, 0.33391148, 0.19150135, -0.0039101164, -0.17634608, -0.24514028, -0.38264456, -0.025199616) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(0.01883554, 0.2352854, 0.024866935, -0.00024026145, -0.050172836, 0.18687594, 0.022473063, -0.03363492, -0.048518196, -0.16801472, 0.08203258, 0.013986874, 0.09926478, 0.05788809, -0.13792841, 0.00041808106) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos0 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(0, 0);
    imageStore(out_image, store_pos0, max(result0, V4(0.0)));
    V4 result1 = V4(0.0060358453, -0.0038571293, -0.010504122, -0.021724712);
    result1 += M4(-0.02406926, 0.010623361, 0.014413498, 0.05547723, -0.17888322, -0.12732728, -0.042138662, -0.07583789, 0.023653535, 0.019855438, -0.05971618, -0.013966604, 0.06618717, 0.027712006, 0.011122565, 0.023498395) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(0.05630823, -0.021410631, 0.072086506, 0.0024062824, -0.01697355, 0.122717276, -0.032003615, 0.20204382, 0.0032783372, 0.1907736, -0.05321094, -0.034932952, -0.09991611, 0.031889927, -0.011733708, 0.0147826765) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.052236937, 0.06719585, -0.1624306, -0.0064803804, 0.010241137, -0.032223742, -0.06216387, -0.0011573939, 0.038819514, -0.02036913, -0.005031427, 0.012980899, 0.06418351, -0.1423971, 0.14534166, -0.074909076) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.077054866, 0.016550235, -0.17486729, 0.02842151, -0.045470264, 0.043020274, 0.05711088, -0.18777566, -0.063013054, -0.07662998, 0.007849522, -0.14989029, 0.34397137, 0.13169111, 0.23732978, 0.0858883) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.14491501, -0.0924199, -0.2217171, -0.19642825, 0.15880273, 0.55947715, 0.18977638, 0.35226947, 0.5809202, -0.048175838, 0.63914937, 0.5737472, 0.0018481517, 0.5206283, 0.2160473, 0.4197073) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(0.060406752, 0.87869066, -0.3055963, 0.9112476, -0.058917947, 0.14208205, 0.30650783, 0.06907621, -0.18348728, 0.06259695, 0.008504865, 0.08239053, -0.1616469, 0.015519495, 0.21113834, -0.05717407) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(0.16468385, -0.04370102, 0.14335965, -0.02375918, -0.24228527, -0.09672579, -0.06575797, -0.08821151, -0.60184294, 0.08338583, 0.14961968, 0.015692472, 0.23661622, 0.31892, -0.013305945, 0.12062196) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.6984104, 0.10283055, 0.33181068, -0.09290665, -1.186339, -0.11819286, -0.47818917, -0.15254717, -0.02841388, -0.2237187, -0.6307707, 0.06997352, -1.0069907, 0.32481638, -0.1744234, 0.144019) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(-1.2721918, -1.134848, -0.9962998, -0.07559179, 0.26932257, -0.11698906, -0.2883527, -0.07715226, 0.26078555, -0.013546061, -0.053522475, -0.09492197, 0.39564198, -0.018518064, -0.007913374, 0.014686286) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.10563746, -0.003274181, 0.030327981, 0.014205595, 0.040462542, 0.009241695, 0.009595521, -0.011617956, 0.03144429, -0.043214574, -0.0659442, -0.037155453, 0.047805656, -0.035213843, 0.071052566, -0.021723706) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(0.12314951, -0.0103606805, 0.17960429, -0.030661423, 0.041362897, -0.02107014, 0.09338019, 0.030121783, 0.048414588, 0.0733451, 0.033237077, 0.05873064, 0.3348748, 0.11943681, 0.4539139, -0.11721637) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.08459594, 0.005308953, 0.01902851, 0.08305948, 0.027481467, -0.04741499, -0.027641647, 0.040843967, -0.057259213, 0.11437789, -0.065213725, 0.13773102, 0.15466706, 0.022813786, 0.18610042, -0.018435031) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(0.065828726, 0.23422824, 0.030645672, 0.2125588, 0.08130832, 0.07025828, 0.018453483, 0.06841814, -0.01051494, -0.008416718, -0.02025299, -0.11815054, 0.048244197, 0.043025218, 0.14093882, 0.033650342) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.7071567, 0.17419478, -0.20823717, 0.1592722, 0.09363045, 0.4382337, -0.20996766, 0.10579416, -0.29833415, -0.28619918, -0.13634226, 0.21905549, -0.8931735, 0.44185206, -0.66467285, 0.015261982) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.24013606, 0.23993768, 0.05237113, 0.12117873, 0.07274393, 0.11919519, -0.12101775, 0.08301356, -0.076125324, -0.23509482, 0.13666745, -0.052164577, -0.14612947, -0.22587076, -0.088539414, -0.16071066) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.17897229, 0.054239348, 0.096895784, 0.09246057, -0.04858884, -0.07089032, -0.17540532, -0.020819455, -0.066840425, 0.070288554, 0.05608902, 0.028893901, 0.24431382, -0.14918096, -0.17714377, -0.07285231) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.37109855, 0.14940417, 0.24432224, 0.021563401, -0.27347052, -0.080288745, 0.09056247, -0.14910485, 0.7819384, 0.06589702, -0.07262684, 0.08348275, -1.068053, 0.11491327, -0.52666503, 0.015474978) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(0.13174483, 0.13699427, -0.09863513, 0.028914629, 0.15679912, 0.075884424, -0.14473449, -0.006555751, 0.2432178, -0.18894246, 0.0084272185, 0.002117364, -0.1640045, 0.05060783, -0.14531392, -0.030653965) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos1 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(1, 0);
    imageStore(out_image, store_pos1, max(result1, V4(0.0)));
}

//!DESC ArtCNN C4F8 (Conv2D-4-ReLU)
//!COMPUTE 16 16 8 16
//!HOOK LUMA
//!BIND conv2d_3
//!SAVE conv2d_4
//!WIDTH LUMA.w 2.0 *
//!HEIGHT LUMA.h
//!COMPONENTS 4
//!WHEN OUTPUT.w LUMA.w / 1.3 > OUTPUT.h LUMA.h / 1.3 > *
#extension GL_EXT_shader_explicit_arithmetic_types_float16 : enable
#ifdef GL_EXT_shader_explicit_arithmetic_types_float16
#	define V4 f16vec4
#	define M4 f16mat4
#	define F float16_t
#else
#	define V4 vec4
#	define M4 mat4
#	define F float
#endif

const ivec2 ksize = ivec2(3, 3);
const ivec2 offset = ksize / 2;
const ivec2 isize = ivec2(gl_WorkGroupSize) + ksize - 1;
shared V4 inp[2][isize.y][isize.x];
void hook() {
    ivec2 base = ivec2(gl_WorkGroupID) * ivec2(gl_WorkGroupSize);
    for (uint y = gl_LocalInvocationID.y; y < isize.y; y += gl_WorkGroupSize.y) {
        for (uint x = gl_LocalInvocationID.x; x < isize.x; x += gl_WorkGroupSize.x) {
            inp[0][y][x] = V4(conv2d_3_mul * texelFetch(conv2d_3_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(0, 0), 0));
            inp[1][y][x] = V4(conv2d_3_mul * texelFetch(conv2d_3_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(1, 0), 0));
        }
    }

    barrier();
    V4 result0 = V4(-0.015141964, -0.0068916464, -0.0002448114, 0.0023949218);
    result0 += M4(-0.05788924, -0.025492001, -0.07671094, -0.03803806, 0.19428918, -5.384943e-05, 0.6582839, -0.096869215, -0.1013055, -0.0034898813, -0.14508171, -0.05589736, -0.11937931, 0.03543712, -0.21367507, 0.19361787) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(0.040762912, 0.012055167, -0.014139789, 0.020303015, 0.30728692, 0.022002673, -0.020639325, -0.035612606, -0.20611629, -0.015458598, -0.06806513, -0.020799618, -0.6187755, -0.031603698, 0.047109347, -0.019262264) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(0.027687287, -0.0059580533, -0.03375668, 0.044978347, 0.08931057, -0.00781137, -0.024042042, 0.035237193, -0.200672, -0.0189654, 0.003554341, 0.018602757, -0.1637883, 0.010027894, 0.012573165, 0.018184336) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(0.12604403, -0.011005351, 0.07122734, 0.07133764, 0.23541568, 0.05253521, 0.7425703, 0.30069086, 0.04322217, -0.004706726, -0.10089213, 0.03356476, 0.17681423, -0.048304114, 0.23268236, -0.39271307) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.133804, 0.015087591, 0.051593147, -0.40243772, 0.15877494, -0.14329241, -0.04282938, 0.29716587, 0.13615116, -0.06631053, 0.06791797, -0.2245755, 0.95146143, 0.2339078, 0.24384624, -0.36068425) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.13603494, 0.020050671, 0.024845995, 0.0024049776, 0.14849426, 0.09779694, -0.00649752, 0.035097223, -0.016037054, 0.07983874, -0.05852543, -0.071617045, 0.02842996, -0.22276598, -0.012528961, 0.018464746) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.10467327, -0.10818476, -2.2185273, 0.07880886, -0.19433486, 0.061172225, -3.129132, -0.027090026, 0.12481196, 0.009488513, -0.89237976, -0.03795706, 0.05174197, 0.041552566, -5.1661806, 0.30341828) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(0.17138515, 0.08219878, -0.12992592, 0.38980314, -0.19719775, 0.055953547, -0.047684245, -0.02760705, 0.12309616, -0.0153487725, 0.030845286, 0.117989294, -0.08452228, 0.19854626, 0.3102549, 0.55488956) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(0.04823124, 0.061745897, 0.06382483, 0.12058235, -0.05488751, -0.036830325, 0.016395794, 0.030183487, 0.13650255, 0.11502404, -0.0370767, 0.030766355, 0.20587792, -0.41408268, -0.03808934, 0.058669608) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result0 += M4(0.06910198, -0.038767964, -0.27599064, 0.14896148, -0.11620954, 0.014319818, -0.33622, 0.048484012, 0.37757754, 0.0044143135, 0.0810316, 0.11140735, 0.02765207, -0.03221013, 0.070667535, -0.014122123) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(0.4276847, 0.04425473, -0.024296181, 0.047898963, -0.23864388, 0.009401112, -0.08882917, 0.20673315, 0.31951523, -0.021170836, 0.045889907, 0.4663291, -0.013934491, 0.0068457406, 0.09592661, -0.13100228) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.008526691, 0.022040283, 0.037115872, -0.09689339, -0.23179944, -0.0046374276, 0.009662274, -0.03821214, 0.2689254, -0.04870737, -0.013298982, 0.051512405, 0.13639633, 0.009938908, 0.0005140589, -0.0029480432) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.12520218, -0.05559951, -0.06832551, -0.13797107, -0.07524973, 0.011820853, -0.9088693, 0.061371576, -0.23349999, 0.056330662, -0.5620247, 0.19529755, -0.1447393, -0.03831649, -0.41603792, -0.1433915) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.29183722, 0.11337011, 0.011804821, -0.12014836, -0.38159007, 0.074040845, 0.027066553, -0.6926994, -0.49752164, -0.1757889, 0.082479835, -0.006026437, 0.56664574, 0.012670466, 0.15501262, 0.45296988) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(0.01079043, -0.006745564, 0.017716303, -0.043621853, 0.0012482334, -0.23389722, -0.008503658, -0.06364529, 0.1061384, -0.041762035, -0.020337423, 0.11074381, -0.030608097, 0.14138867, -0.018017275, 0.04399546) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(0.050618313, -0.026269892, -0.654473, -0.021201434, 0.061364956, 0.065342195, -0.53778887, -0.3037699, 0.17813186, -0.066473015, -1.092747, 0.16001463, -0.107018225, -0.10390031, -0.23389764, 0.008245459) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(0.061218254, -0.01329794, -0.012722596, 0.024540303, 0.37099686, -0.17654586, -0.018636009, 0.23821788, 0.124400295, -0.0030885057, 0.007109515, 0.067388795, -0.9085592, 0.21562512, 0.029154526, -0.66539073) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.00025441128, -0.00091612374, -0.015394841, 0.013856121, 0.0949312, -0.047289975, -0.021025196, 0.033699244, -0.010467459, 0.005043337, -0.0076139946, 0.010535834, -0.20752548, 0.020704607, 0.014073103, -0.15792514) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos0 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(0, 0);
    imageStore(out_image, store_pos0, max(result0, V4(0.0)));
    V4 result1 = V4(-0.012018575, -0.018649586, -0.036945883, -0.07064397);
    result1 += M4(-0.047964875, -0.0086722905, -0.07087279, -0.003826263, 0.095588565, 0.0022615045, -0.0739922, 0.012625914, -0.003995655, -0.004643326, 0.1081074, 0.0039266516, -0.4680548, 0.031466555, 0.19732884, -0.073115565) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.0029823282, -0.0043058093, 0.016010156, -0.13652858, -0.011434812, -0.0460691, -0.070437655, 0.21723524, -0.015409446, -0.038872074, 0.25017402, 0.025168981, -0.14848843, 0.055817187, -0.30710614, -0.1086217) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.04404943, -0.012964352, -0.003394893, 0.00058961654, 0.018152524, 0.017115723, 0.17142546, -0.14742528, -0.015276425, -0.031932134, -0.05860435, 0.11649892, -0.07138624, -0.034258585, -0.03506139, 0.15581875) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.0053699645, -0.015659668, -0.1740588, -0.041220393, -0.012680068, 0.05380872, 0.08667007, -0.25627723, -0.007914821, 0.022520334, 0.28567955, -0.14063372, 0.13079739, -0.12965573, 0.33113027, 0.35565642) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(0.004753832, -0.029931916, 0.7243844, -0.27765504, -0.023836903, 0.40178242, -0.1361776, 0.78190154, -0.0013883054, -0.032332405, -0.19375204, 0.9377955, -0.07075969, -0.2595614, -0.9722041, -0.5545397) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(0.029331487, -0.08792405, -0.3423008, 0.13457915, -0.00015754564, 0.08998702, 0.020726493, -0.1680619, 0.022247817, -0.027017884, 0.20594221, -0.0779652, 0.0012917687, 0.011935255, 0.28204623, 0.041349582) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(0.012508367, 0.03521656, -0.11660593, 0.12698622, 0.017032038, -0.045732655, 0.033487618, 0.03900892, -0.010571299, 0.023642821, 0.00542904, 0.039774526, -0.01611152, 0.12370299, 0.0018028799, -0.3362598) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.005716289, 0.21101044, 0.00025273825, -0.38563693, 0.014062104, -0.3129184, -0.0039363485, -0.037776846, -0.0025180154, 0.17500667, 0.03773452, 0.33071485, -0.04845905, 0.5410115, -0.056130804, 0.6144648) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.011524216, 0.24943459, -0.0132758785, 0.15877488, 0.011510759, -0.0174923, 0.03321036, 0.11264394, -0.017730929, 0.10846223, -0.05907423, -0.15603521, -0.019286046, 0.11887045, 0.08921295, -0.37484333) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.07381301, 0.028390804, -0.027877277, -0.01675848, 0.018738909, 0.031607106, 0.16299912, 0.027625374, 0.014551719, 0.03761189, -0.06905902, -0.22300996, 0.17010865, -0.029182075, -0.17932433, 0.05606539) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.045620292, 0.07359618, 0.27348217, -0.12615648, -0.21531305, 0.030782387, -0.52499014, -0.22549425, -0.06927704, -0.17765324, -0.16082443, 0.3014576, 0.31797212, 0.006237835, 0.49225888, -0.01885995) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.02799437, -0.018330159, -0.20132601, -0.06111752, -0.058834616, -0.058451843, 0.014803376, 0.082466096, -0.07389133, 0.056185644, 0.0854706, -0.1532804, 0.049768526, 0.040672638, -0.070320636, 0.054841116) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.0047528404, -0.027763855, -0.08974706, 0.0691105, 0.038931135, -0.028628072, -0.017779402, -0.2664988, -0.010108406, 0.10595292, -0.036400955, -0.14748512, -0.01760317, 0.013155294, -0.016864574, 0.18621847) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(0.0044820434, -0.197738, 0.12806268, -0.37672785, 0.008012078, -0.34227777, -0.5176798, 0.28635418, 0.009071039, 0.30965474, 0.0052926647, -0.16987811, 0.06016898, 0.2297172, 0.27975506, -0.30130264) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(0.0064895386, -0.021539534, -0.05664836, 0.28060874, 0.043406084, -0.07421741, 0.1540936, -0.12559491, -0.017784089, 0.09532122, 0.027768355, -0.027033186, -0.034377057, 0.036314245, -0.016187409, 0.17115673) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(0.00019983921, -0.017783958, -0.037132543, -0.05739988, -0.013882904, -0.07986122, -0.0020805357, -0.06399617, -0.020438096, 0.13623169, 0.012550801, -0.034794822, -0.01667691, -0.03333268, -0.14047773, 0.23411016) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.0058334284, 0.17842738, -0.029785974, 0.017914979, -0.0146555, 0.09788158, -0.00815268, -0.06612175, -0.013083016, 0.20015414, -0.047233995, -0.026990788, 0.062372386, -0.765985, 0.3219493, -0.46547192) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(0.0048141945, -0.0236722, -0.01731361, -0.0027973219, 0.006781286, 0.012373445, 0.027126664, -0.080492035, -0.00078731374, 0.053789653, 0.0039537037, -0.035404883, -0.023183614, -0.24746455, -0.1784436, 0.24913958) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos1 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(1, 0);
    imageStore(out_image, store_pos1, max(result1, V4(0.0)));
}

//!DESC ArtCNN C4F8 (Conv2D-5)
//!COMPUTE 16 16 8 16
//!HOOK LUMA
//!BIND conv2d_4
//!SAVE conv2d_5
//!WIDTH LUMA.w 2.0 *
//!HEIGHT LUMA.h
//!COMPONENTS 4
//!WHEN OUTPUT.w LUMA.w / 1.3 > OUTPUT.h LUMA.h / 1.3 > *
#extension GL_EXT_shader_explicit_arithmetic_types_float16 : enable
#ifdef GL_EXT_shader_explicit_arithmetic_types_float16
#	define V4 f16vec4
#	define M4 f16mat4
#	define F float16_t
#else
#	define V4 vec4
#	define M4 mat4
#	define F float
#endif

const ivec2 ksize = ivec2(3, 3);
const ivec2 offset = ksize / 2;
const ivec2 isize = ivec2(gl_WorkGroupSize) + ksize - 1;
shared V4 inp[2][isize.y][isize.x];
void hook() {
    ivec2 base = ivec2(gl_WorkGroupID) * ivec2(gl_WorkGroupSize);
    for (uint y = gl_LocalInvocationID.y; y < isize.y; y += gl_WorkGroupSize.y) {
        for (uint x = gl_LocalInvocationID.x; x < isize.x; x += gl_WorkGroupSize.x) {
            inp[0][y][x] = V4(conv2d_4_mul * texelFetch(conv2d_4_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(0, 0), 0));
            inp[1][y][x] = V4(conv2d_4_mul * texelFetch(conv2d_4_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(1, 0), 0));
        }
    }

    barrier();
    V4 result0 = V4(-0.005399531, -0.06989371, -0.0782649, -0.048932143);
    result0 += M4(-0.009059216, -0.022938985, 0.0024570965, 0.006148934, -0.049089856, 0.2831825, -0.27003068, 0.118308984, 0.054036498, -0.035515003, -0.008099666, 0.06360712, 0.03304741, -0.051543906, 0.029595787, -0.01190326) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.024112593, 0.120948784, -0.07806846, 0.01709853, 0.055118624, -0.27947843, 0.34605238, 0.02414703, 0.14990951, -0.04007881, -0.2631196, 0.12028072, -0.02938325, -0.04281419, -0.02668741, -0.03358909) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.004351789, -0.012066875, 0.07465611, -0.004585185, -0.0025329564, -0.02588291, -0.0052927467, -0.0022448595, 0.024082152, 0.98657453, -0.15163413, 0.14048882, 0.01975696, 0.029424986, -0.028161215, 0.02862582) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(0.13809028, 0.027191075, -0.28646266, 0.123044826, -0.18733083, -0.16540153, 0.20530257, -0.20140208, 0.035560198, 0.055690758, 0.010801598, -0.04901108, 0.07637336, 0.10707978, -0.10727507, 0.10656397) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.28813145, -0.44023874, 0.60142034, -0.2677138, -0.0071346313, -0.2979475, -0.028883189, 0.1708541, 0.52187437, 0.5471128, -0.0878714, 0.24386512, -0.038991578, -0.13932407, 0.41454038, -0.72567815) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.03547764, 0.06395088, -0.019409845, 0.006990009, 0.0029580477, 0.08950537, -0.0061523328, -0.014658544, 0.0036268148, 0.27775386, -0.619131, 0.093407944, -0.06526381, -0.65529734, -0.035846703, 0.10095343) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(0.01789512, -0.0022697216, -0.0743504, -0.018927945, -0.021831973, -0.013817752, 0.045838468, -0.045320746, 0.0050817006, 0.025360774, -0.020452935, 0.015652673, 0.007870144, -0.006332815, -0.061047867, 0.053552963) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.02074479, 0.23030838, 0.1294459, -0.11086634, -0.015027606, -0.09061603, -0.0007801785, 0.007756951, -0.04290776, -0.06967359, 0.05002433, -0.23111922, -0.041973166, -0.023540186, -0.09098968, -0.090430975) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(0.0044681397, 0.039944313, -0.030878253, 0.009410991, 0.014998361, -0.014637884, -0.0070505, 0.010918844, 0.120806135, 0.024680333, -0.03356382, 0.10447885, 0.010402907, 0.04263625, -0.027709486, 0.005953159) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.01679444, 0.059942964, 0.038288165, -0.026760079, -0.053172987, 0.061555054, 0.36559498, -0.0066349427, -0.0061789784, 0.0070278766, -0.028558357, 0.022820054, 0.00820455, 0.027682707, 0.05662328, -0.021490136) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(0.016421549, -0.09485137, -0.059342247, 0.027197076, 0.19592467, 0.7958078, -1.1289415, 0.43740824, -0.009536314, 0.3273548, 0.183258, -0.051342938, -0.033612642, -0.2965392, -0.11113444, -0.031108178) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.0007178652, 0.07428028, -0.014278613, -0.006113239, 0.05672437, 0.4044694, 0.1905922, 0.021950506, 0.013824928, -0.014253129, -0.04616475, 0.004942006, -0.006039774, 0.129518, -0.04894205, -0.009768419) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.06038906, -0.08312885, -0.04769052, -0.0006160376, 0.09085636, -0.043833792, -0.021116223, 0.08618872, -0.13162121, 0.015123861, 0.35713112, -0.28835505, 0.030511685, 0.008303917, -0.3176193, 0.33572945) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(0.1578681, 0.10862417, 0.09274257, 0.01539245, -0.21497732, -0.27121598, -0.038252626, 0.5550126, -0.3255565, -0.81941086, 0.08811417, -0.0029584821, 0.71386474, 1.0416704, -0.3636715, 0.4612784) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.033879817, -0.28055862, 0.017273141, 0.020928701, 0.0912122, 0.7883747, 0.05430918, -0.057052005, 0.021821814, -0.06568747, -0.11750038, 0.04517341, -0.043732364, 0.19149518, 0.052425187, -0.04367341) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.04506223, -0.027928436, -0.17979455, -0.003739892, -0.008967554, -0.011531311, -0.0077601355, -0.040981553, -0.056191497, -0.062047143, 0.10291195, -0.039864726, -0.006231264, 0.0071230396, 0.059344605, -0.05157675) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.27014652, -0.74377835, 0.6911828, -0.13158742, 0.022979401, 0.1783198, 0.23184644, 0.05885917, 0.04851581, -0.15219164, -0.12141426, 0.08505352, -0.06782243, -0.11414642, -0.008068624, -0.12602682) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(0.05239315, 0.021696458, -0.028616136, -0.041255526, -0.012194439, -0.07185951, 0.012699548, -0.00075031415, 0.02011646, -0.044597942, -0.061171755, 0.0020242094, -0.03212798, 0.02186932, 0.06435457, -0.011390952) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos0 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(0, 0);
    imageStore(out_image, store_pos0, result0);
    V4 result1 = V4(-0.04499983, -0.05226695, 0.045174174, 0.021668067);
    result1 += M4(0.009531323, 0.0062547643, -0.030894455, 0.0070643383, -0.23404475, -0.34635675, -0.0065162093, 0.29972452, -0.0205944, 0.12897712, -0.05144986, -0.045257725, 0.031105628, 0.14316729, 0.011688224, -0.080156066) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.06252941, -0.038883325, 0.08099649, 0.008219227, -0.32323572, 0.41854852, -0.11126836, -0.1927204, -0.17634445, 0.338852, -0.107524455, -0.07332099, 0.075453885, -0.12919345, 0.025687532, 0.0956408) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(0.0076332414, -0.07805251, 0.027485915, 0.0015048562, -0.046921995, -0.045706306, 0.00018944588, -0.03147307, -0.12948407, 0.8848906, -0.075546876, 0.09300168, -0.036469493, 0.06290515, -0.020212267, -0.00036711188) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.19061545, 0.31450328, 0.009729654, -0.13291353, 0.163121, -0.09104934, 0.16068745, -0.151213, -0.057365276, 0.012152018, 0.1538198, -0.04016395, -0.10933338, 0.09473194, -0.028811133, 0.01681608) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.24420993, -1.1346202, 0.19071178, -0.23043312, 0.004350025, -0.15173721, -0.07092776, -0.19848618, -0.41384616, -0.21413474, 0.28593144, 0.045362025, 0.24172407, -0.7843332, 0.32517448, -0.14731036) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(0.16822144, 0.107839026, -0.053202037, 0.08626698, 0.04429789, -0.07108384, -0.0010545993, -0.0012054094, 1.0260462, 0.95629644, -0.15342484, 0.504853, 0.2386068, 0.051800564, -0.2692932, -0.22104496) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.009154612, 0.071302, -0.02087889, -0.0044445815, 0.04085089, -0.01565516, 0.010233007, -0.030265676, -0.019782599, 0.0023682022, -0.008401822, 0.017845213, -0.029961377, 0.008368645, -0.0420671, 0.003253662) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.13411686, -0.10154361, -0.20690182, -0.007464854, 0.026865035, -0.016713182, 0.005274871, -0.03345257, 0.063891456, -0.13276654, 0.27518937, -0.015750654, -0.012214049, -0.10768503, -0.019654822, -0.017646749) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.028979186, 0.14889283, -0.020194339, 0.045384664, 0.012829929, 0.03435167, 0.047808774, 0.022486798, -0.045509104, 0.65336084, 0.20253667, 0.25318837, -0.11897359, -0.057579197, -0.09233707, -0.07469856) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result1 += M4(0.030387318, -0.087692335, 0.03756076, 0.068351224, 0.20603903, -0.2477715, -0.15820152, 0.17004699, -0.061353996, -0.048690617, 0.032599673, -0.029692447, 0.09886448, 0.07666687, -0.010487426, 0.052896045) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.035087887, 0.09018208, -0.041734785, -0.080100864, 0.4073013, 1.5647801, 0.33476982, 0.87027603, 0.18211041, -0.13113824, 0.08638093, 0.24086507, -0.107139535, 0.07058423, 0.07319461, -0.16438897) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result1 += M4(0.022476949, 0.017126372, 0.009549605, 0.036449548, -0.39513528, -0.123803236, -0.0864842, -0.097146235, 0.024483288, 0.03997793, 0.012507402, 0.004186965, 0.084011644, -0.024583444, 0.071594566, 0.094506145) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result1 += M4(0.04556858, 0.036887847, -0.053681325, -0.054522667, -0.0023623994, 0.102832876, -0.039508644, -0.09248028, 0.18419637, -0.38380706, 0.23668477, 0.09578263, -0.14605238, 0.13405521, -0.39107263, 0.04658734) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result1 += M4(-0.27310276, -0.048205383, 0.21563168, -0.031468455, -0.21219799, 0.46888727, 0.16962527, 0.32209685, 1.2464602, 0.90374905, -0.63867724, 0.13841076, -1.2617414, 0.06362392, -0.24451871, -0.119239226) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.024210203, -0.104422145, -0.0339866, -0.1117084, -0.18216822, 0.00823125, 0.2559783, 0.26108855, 0.054941084, 0.14264542, -0.030720014, 0.016361486, -0.12867914, -0.20134982, -0.22377607, -0.088688485) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result1 += M4(-0.12913905, -0.071094565, 0.07894496, -0.05175835, 0.04286753, 0.040535197, 0.00065822573, -0.0055801976, 0.06698773, -0.06015721, 0.061867557, -0.028373525, 0.018054402, -0.024683123, 0.042452496, -0.0035246625) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result1 += M4(0.19257087, -0.1985791, -0.6068753, -0.43266937, -0.16347133, -0.015419142, -0.12195866, -0.055208616, 0.048910547, 0.04094601, 0.2785039, 0.03389136, 0.19190775, 0.031884048, 0.05950292, 0.05817983) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result1 += M4(-0.35257912, -0.24251436, 0.041382913, -0.22734511, 0.14932881, 0.06073281, 0.09370643, 0.067880146, 0.09744215, -0.073473394, 0.10539246, 0.037641935, -0.033692215, 0.044065055, -0.008790005, 0.02507663) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos1 = ivec2(gl_GlobalInvocationID) * ivec2(2, 1) + ivec2(1, 0);
    imageStore(out_image, store_pos1, result1);
}

//!DESC ArtCNN C4F8 (Conv2D-6)
//!COMPUTE 16 16 16 16
//!HOOK LUMA
//!BIND conv2d
//!BIND conv2d_5
//!SAVE conv2d_6
//!WIDTH LUMA.w 1.0 *
//!HEIGHT LUMA.h
//!COMPONENTS 4
//!WHEN OUTPUT.w LUMA.w / 1.3 > OUTPUT.h LUMA.h / 1.3 > *
#extension GL_EXT_shader_explicit_arithmetic_types_float16 : enable
#ifdef GL_EXT_shader_explicit_arithmetic_types_float16
#	define V4 f16vec4
#	define M4 f16mat4
#	define F float16_t
#else
#	define V4 vec4
#	define M4 mat4
#	define F float
#endif

const ivec2 ksize = ivec2(3, 3);
const ivec2 offset = ksize / 2;
const ivec2 isize = ivec2(gl_WorkGroupSize) + ksize - 1;
shared V4 inp[2][isize.y][isize.x];
void hook() {
    ivec2 base = ivec2(gl_WorkGroupID) * ivec2(gl_WorkGroupSize);
    for (uint y = gl_LocalInvocationID.y; y < isize.y; y += gl_WorkGroupSize.y) {
        for (uint x = gl_LocalInvocationID.x; x < isize.x; x += gl_WorkGroupSize.x) {
            inp[0][y][x] = V4(conv2d_5_mul * texelFetch(conv2d_5_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(0, 0), 0) + conv2d_mul * texelFetch(conv2d_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(0, 0), 0));
            inp[1][y][x] = V4(conv2d_5_mul * texelFetch(conv2d_5_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(1, 0), 0) + conv2d_mul * texelFetch(conv2d_raw, (base + ivec2(x,y) - offset) * ivec2(2, 1) + ivec2(1, 0), 0));
        }
    }

    barrier();
    V4 result0 = V4(0.112650715, 0.16189022, 0.14923191, 0.17340848);
    result0 += M4(0.047875293, -0.062111802, -0.12907559, -0.140046, -0.02075308, 0.013759879, 0.017409565, 0.02137077, -0.124785654, 0.010197244, 0.019522766, 0.03218809, 0.14474854, -0.02818024, -0.023797985, -0.058441214) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(0.2663617, 0.0235228, 0.19506787, 0.08176694, -0.053287428, -0.0661415, 0.040946506, 0.068367966, 0.0018439605, 0.01661067, 0.0039937967, 0.023598392, 0.16924459, 0.01311004, -0.08479276, -0.07688504) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(0.00045475108, 0.2037543, -0.041726362, 0.07220359, 0.03250867, -0.028422864, 0.019897584, 0.0007916389, 0.01016283, -0.041894116, 0.015530047, -0.0094274655, -0.057673994, -0.002039236, -0.059408642, -0.06457994) * inp[0][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.049714167, -0.12244926, 0.04184301, -0.009384062, -0.1789333, 0.11765252, -0.24015693, 0.1607276, 0.19266005, 0.028154159, 0.0903521, 0.039742064, 0.026219567, -0.05685963, 0.028443646, -0.15869163) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(0.30922833, 0.4190073, 0.1676443, -0.027315162, 0.3142011, -0.05200954, 0.35905266, -0.08271924, 0.32759675, 0.7332667, 0.2592413, 0.49172208, 0.32490137, 0.22525308, 0.7135096, 0.5545461) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(0.2693023, 0.07877189, 0.2589704, 0.28632852, -0.015166302, -0.050514538, -0.003153822, -0.028106652, 0.06951018, 0.04564901, 0.065166555, 0.004383877, -0.35614243, 0.02537259, -0.25705642, 0.15707311) * inp[0][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(0.08311068, 0.07169329, 0.040660616, -0.017488748, -0.033118267, 0.035249423, -0.12246105, 0.06695251, -0.0009507637, -0.018800197, 0.03516657, -0.02727321, -0.0044037867, 0.031249508, -0.05485948, -0.019803364) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(0.10189571, 0.1495331, 0.23634061, 0.3534875, -0.0009864058, -0.022008266, 0.04414748, -0.2541994, -0.0072981194, -0.007089789, 0.05559923, 0.18823674, -0.066107154, -0.089976795, 0.036127888, -0.033324514) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(-0.05851292, -0.014666582, 0.09539354, 0.12767793, 0.020247035, 0.020604813, -0.0149618285, -0.07566735, -0.01367394, -0.00017988874, 0.011512181, 0.011766649, 0.007894729, -0.012464777, -0.14059538, -0.075213104) * inp[0][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    result0 += M4(0.2502351, -0.059486054, -0.0394238, -0.10101496, -0.10725275, 0.03538669, 0.035246186, 0.067940824, 0.031984635, -0.035988398, -0.006907948, -0.023124741, -0.12445041, 0.03428843, 0.0024777264, 0.03325532) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 0];
    result0 += M4(-0.16690275, 0.0007419632, -0.02932872, 0.00038109603, -0.023680264, 0.018035768, -0.020400219, -0.018640883, -0.020075329, 0.19162166, 0.013653249, 0.015794493, 0.20189372, 0.0341025, -0.04811513, -0.10758123) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 1];
    result0 += M4(0.043022633, -0.014467474, 0.023674376, 0.021500228, 0.012469097, -0.043316133, 0.013496057, -0.008678949, 0.014783185, -0.049829397, -0.0024954034, 0.0062673166, -0.09396389, 0.07187579, -0.054164883, -0.032352243) * inp[1][gl_LocalInvocationID.y + 0][gl_LocalInvocationID.x + 2];
    result0 += M4(-0.2885216, -0.10847371, -0.11270419, -0.06539476, 0.0240285, -0.03600163, 0.08444924, 0.011315125, -0.04675797, -0.0689525, 0.017380979, -0.14863075, -0.006876377, -0.15602097, 0.23357107, -0.10952388) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 0];
    result0 += M4(0.1987013, 0.22691326, 0.18999875, 0.27443758, -0.35361347, -0.009741564, -0.042690456, 0.25314155, 0.16011114, -0.021114793, 0.16075197, 0.5136634, 0.076367795, -0.14696282, -0.05261416, 0.021560412) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 1];
    result0 += M4(0.06720078, -0.02035629, 0.05855859, -0.01775673, 0.06263363, -0.06900724, 0.04668665, -0.07087316, -0.076518595, -0.111166134, -0.007026008, -0.13264121, -0.034157585, 0.23887303, -0.105821736, 0.1775644) * inp[1][gl_LocalInvocationID.y + 1][gl_LocalInvocationID.x + 2];
    result0 += M4(0.01741443, 0.08684296, -0.14200759, 0.02152267, -0.006881909, -0.03737592, -0.017633826, -0.0339784, -0.0064787464, 0.0024558087, -0.029274603, -0.011224243, -0.04189926, -0.06319204, 0.021346025, -0.04961424) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 0];
    result0 += M4(0.027187122, 0.034861013, 0.069479294, -0.06257304, 0.057199817, 0.006457512, -0.1397731, -0.12472732, -0.057243362, -0.08462385, 0.08056776, -0.05579161, 0.016396707, 0.044967018, 0.017215747, 0.15803006) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 1];
    result0 += M4(0.008812899, 0.023759654, 0.007595762, -0.05650468, 0.027099561, 0.022359984, 0.010927399, -0.074057385, 0.035354547, 0.022373846, -0.04258218, -0.09305401, -0.0817461, -0.066233456, 0.03172634, 0.22857392) * inp[1][gl_LocalInvocationID.y + 2][gl_LocalInvocationID.x + 2];
    ivec2 store_pos0 = ivec2(gl_GlobalInvocationID) * ivec2(1, 1) + ivec2(0, 0);
    imageStore(out_image, store_pos0, result0);
}

//!DESC ArtCNN C4F8 (Depth-To-Space)
//!COMPUTE 16 16 16 16
//!HOOK LUMA
//!BIND conv2d_6
//!WIDTH LUMA.w 2.0 *
//!HEIGHT LUMA.h 2.0 *
//!COMPONENTS 4
//!WHEN OUTPUT.w LUMA.w / 1.3 > OUTPUT.h LUMA.h / 1.3 > *
#extension GL_EXT_shader_explicit_arithmetic_types_float16 : enable
#ifdef GL_EXT_shader_explicit_arithmetic_types_float16
#	define V4 f16vec4
#	define M4 f16mat4
#	define F float16_t
#else
#	define V4 vec4
#	define M4 mat4
#	define F float
#endif

void hook() {
    vec4 result = vec4(0.0, 0.0, 0.0, 1.0);
    vec2 f0 = fract(conv2d_6_pos * conv2d_6_size);
    ivec2 i0 = ivec2(f0 * vec2(2.0));
    result.x = conv2d_6_tex((vec2(0.5) - f0) * conv2d_6_pt + conv2d_6_pos)[i0.y * 2 + i0.x];
    imageStore(out_image, ivec2(gl_GlobalInvocationID), clamp(result, 0.0, 1.0));
}

